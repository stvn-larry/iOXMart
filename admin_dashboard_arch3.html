<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IXMRT Admin Dashboard - Production Ready</title>
    
    <!-- GitHub Pages: https://crvstal.github.io/adminarch/ -->
    
    <!-- External Dependencies for Production -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@project-serum/anchor@latest/dist/anchor.min.js"></script>
    <script src="https://unpkg.com/axios@1.6.0/dist/axios.min.js"></script>
    
    <style>
        /* Import IXMRT Design System */
        :root {
            --ixmrt-primary-600: #5a67d8;
            --ixmrt-primary-700: #4c51bf;
            --ixmrt-gray-50: #f9fafb;
            --ixmrt-gray-100: #f3f4f6;
            --ixmrt-gray-200: #e5e7eb;
            --ixmrt-gray-500: #6b7280;
            --ixmrt-gray-600: #4b5563;
            --ixmrt-gray-700: #374151;
            --ixmrt-gray-800: #1f2937;
            --ixmrt-success-500: #10b981;
            --ixmrt-success-50: #ecfdf5;
            --ixmrt-success-800: #065f46;
            --ixmrt-error-500: #ef4444;
            --ixmrt-error-50: #fef2f2;
            --ixmrt-warning-400: #fbbf24;
            --solana-gradient: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--ixmrt-gray-50);
            color: var(--ixmrt-gray-800);
            line-height: 1.6;
        }
        
        .admin-header {
            background: var(--solana-gradient);
            color: white;
            padding: 25px 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-title {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }
        
        .admin-subtitle {
            opacity: 0.9;
            margin: 5px 0 0 0;
            font-size: 14px;
        }
        
        .wallet-connection {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .wallet-status {
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #14F195;
        }
        
        .connect-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .connect-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid var(--ixmrt-gray-200);
            border-left: 4px solid;
            transition: all 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card.pending { border-color: #f59e0b; }
        .stat-card.active { border-color: #10b981; }
        .stat-card.disputed { border-color: #ef4444; }
        .stat-card.agents { border-color: #8b5cf6; }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-loading {
            width: 20px;
            height: 20px;
            border: 2px solid var(--ixmrt-gray-200);
            border-top-color: var(--ixmrt-primary-600);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .stat-label {
            color: #64748b;
            font-size: 14px;
            margin: 5px 0 0 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid var(--ixmrt-gray-200);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .section-header {
            background: var(--ixmrt-gray-50);
            border-bottom: 1px solid var(--ixmrt-gray-200);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .refresh-btn {
            background: none;
            border: 1px solid var(--ixmrt-gray-300);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--ixmrt-gray-600);
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .refresh-btn:hover {
            background: var(--ixmrt-gray-100);
            border-color: var(--ixmrt-gray-400);
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: var(--ixmrt-gray-50);
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            color: #475569;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--ixmrt-gray-200);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .table td {
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }
        
        .table tr:hover {
            background: var(--ixmrt-gray-50);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-disputed { background: #fee2e2; color: #991b1b; }
        .status-completed { background: #e0e7ff; color: #3730a3; }
        .status-verified { background: #d1fae5; color: #065f46; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--ixmrt-primary-600);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: var(--ixmrt-primary-700);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: var(--ixmrt-success-500);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: #059669;
        }
        
        .btn-danger {
            background: var(--ixmrt-error-500);
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }
        
        .btn-secondary {
            background: var(--ixmrt-gray-200);
            color: var(--ixmrt-gray-700);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #cbd5e1;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--ixmrt-gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--ixmrt-gray-50);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--ixmrt-gray-200);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            background: var(--ixmrt-gray-50);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--ixmrt-gray-200);
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--ixmrt-primary-600);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1);
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .alert-success {
            background: var(--ixmrt-success-50);
            border-color: #a7f3d0;
            color: var(--ixmrt-success-800);
        }
        
        .alert-warning {
            background: #fef3c7;
            border-color: #fde68a;
            color: #92400e;
        }
        
        .alert-danger {
            background: var(--ixmrt-error-50);
            border-color: #fecaca;
            color: #991b1b;
        }
        
        .alert-info {
            background: #eff6ff;
            border-color: #bfdbfe;
            color: #1e40af;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
        }
        
        .loading-state {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--ixmrt-gray-200);
            border-radius: 50%;
            border-top-color: var(--ixmrt-primary-600);
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #9ca3af;
            padding: 4px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .agent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--solana-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        
        .escrow-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .detail-label {
            font-weight: 600;
            color: #6b7280;
        }
        
        .detail-value {
            color: #1f2937;
            font-weight: 500;
        }
        
        .error-state {
            text-align: center;
            padding: 40px;
            color: var(--ixmrt-error-500);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 40px;
            color: #6b7280;
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .toast-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: white;
            border: 1px solid var(--ixmrt-gray-200);
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            padding: 16px 20px;
            min-width: 300px;
            max-width: 400px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .toast-success { border-left: 4px solid var(--ixmrt-success-500); }
        .toast-error { border-left: 4px solid var(--ixmrt-error-500); }
        .toast-warning { border-left: 4px solid var(--ixmrt-warning-400); }
        .toast-info { border-left: 4px solid var(--ixmrt-primary-600); }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 20px 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .escrow-details {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="header-content">
            <div>
                <h1 class="admin-title">IXMRT Admin Dashboard</h1>
                <p class="admin-subtitle">Production-ready blockchain governance and agent management</p>
            </div>
            
            <div class="wallet-connection">
                <div id="wallet-status" class="wallet-status" style="display: none;">
                    <div class="status-indicator"></div>
                    <span id="wallet-address">Not Connected</span>
                </div>
                
                <button id="connect-wallet-btn" class="connect-btn" onclick="connectAdminWallet()">
                    Connect Admin Wallet
                </button>
            </div>
        </div>
    </header>
    
    <div class="dashboard-container">
        <!-- Real-time Metrics -->
        <div class="stats-grid">
            <div class="stat-card pending">
                <h3 class="stat-value" id="pending-count">
                    <div class="stat-loading"></div>
                </h3>
                <p class="stat-label">Pending Approvals</p>
            </div>
            
            <div class="stat-card active">
                <h3 class="stat-value" id="active-count">
                    <div class="stat-loading"></div>
                </h3>
                <p class="stat-label">Active Contracts</p>
            </div>
            
            <div class="stat-card disputed">
                <h3 class="stat-value" id="disputed-count">
                    <div class="stat-loading"></div>
                </h3>
                <p class="stat-label">Disputes to Resolve</p>
            </div>
            
            <div class="stat-card agents">
                <h3 class="stat-value" id="agents-count">
                    <div class="stat-loading"></div>
                </h3>
                <p class="stat-label">Verified Agents</p>
            </div>
        </div>
        
        <!-- Pending Agent Registrations -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    Agent Registration Queue
                    <span id="agent-badge" class="status-badge status-pending">Loading...</span>
                </h2>
                <button class="refresh-btn" onclick="refreshAgentData()">
                    🔄 Refresh
                </button>
            </div>
            
            <div style="padding: 0 30px 20px;">
                <div class="filters">
                    <div class="filter-group">
                        <label class="filter-label">Location</label>
                        <select class="form-select" id="location-filter" onchange="applyAgentFilters()">
                            <option value="">All Locations</option>
                            <option value="computer-village">Computer Village</option>
                            <option value="unilag">UNILAG Area</option>
                            <option value="unical">UNICAL Area</option>
                            <option value="uniben">UNIBEN Area</option>
                            <option value="caleb">Caleb University</option>
                            <option value="uniabuja">University of Abuja</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Experience</label>
                        <select class="form-select" id="experience-filter" onchange="applyAgentFilters()">
                            <option value="">All Experience</option>
                            <option value="1-2">1-2 years</option>
                            <option value="3-5">3-5 years</option>
                            <option value="6-10">6-10 years</option>
                            <option value="10+">10+ years</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">KYC Status</label>
                        <select class="form-select" id="kyc-filter" onchange="applyAgentFilters()">
                            <option value="">All KYC Status</option>
                            <option value="verified">Verified</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Agent Details</th>
                            <th>Business Info</th>
                            <th>Location</th>
                            <th>Experience</th>
                            <th>Success Rate</th>
                            <th>Submitted</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="pending-agents">
                        <tr>
                            <td colspan="7" class="loading-state">
                                <div>Loading agent registrations...</div>
                                <div class="loading-spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Blockchain Escrow Contracts -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    Blockchain Escrow Management
                    <span id="escrow-badge" class="status-badge status-pending">Loading...</span>
                </h2>
                <button class="refresh-btn" onclick="refreshEscrowData()">
                    🔄 Refresh Chain
                </button>
            </div>
            
            <div style="padding: 0 30px 20px;">
                <div class="filters">
                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select class="form-select" id="escrow-filter" onchange="applyEscrowFilters()">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending Approval</option>
                            <option value="active">Active</option>
                            <option value="disputed">Disputed</option>
                            <option value="completed">Completed</option>
                            <option value="resolved">Resolved</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Contract Type</label>
                        <select class="form-select" id="type-filter" onchange="applyEscrowFilters()">
                            <option value="">All Types</option>
                            <option value="PayToLearn">Pay to Learn</option>
                            <option value="CompensationAfterService">Earn After Service</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Amount Range</label>
                        <select class="form-select" id="amount-filter" onchange="applyEscrowFilters()">
                            <option value="">All Amounts</option>
                            <option value="0-0.1">0 - 0.1 SOL</option>
                            <option value="0.1-0.5">0.1 - 0.5 SOL</option>
                            <option value="0.5-1">0.5 - 1 SOL</option>
                            <option value="1+">1+ SOL</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Contract ID</th>
                            <th>Participants</th>
                            <th>Amount</th>
                            <th>Type</th>
                            <th>Duration</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="escrow-list">
                        <tr>
                            <td colspan="8" class="loading-state">
                                <div>Loading blockchain contracts...</div>
                                <div class="loading-spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- System Health & Analytics -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Training Data & AI Analytics</h2>
                <button class="refresh-btn" onclick="refreshAnalytics()">
                    🔄 Refresh Data
                </button>
            </div>
            
            <div style="padding: 30px;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 class="stat-value" id="training-records">
                            <div class="stat-loading"></div>
                        </h3>
                        <p class="stat-label">Repair Process Records</p>
                    </div>
                    
                    <div class="stat-card">
                        <h3 class="stat-value" id="quality-scores">
                            <div class="stat-loading"></div>
                        </h3>
                        <p class="stat-label">Average Quality Score</p>
                    </div>
                    
                    <div class="stat-card">
                        <h3 class="stat-value" id="completion-rate">
                            <div class="stat-loading"></div>
                        </h3>
                        <p class="stat-label">Success Rate</p>
                    </div>
                    
                    <div class="stat-card">
                        <h3 class="stat-value" id="blockchain-health">
                            <div class="stat-loading"></div>
                        </h3>
                        <p class="stat-label">Blockchain Status</p>
                    </div>
                </div>
                
                <div id="system-alerts">
                    <!-- Dynamic alerts will be inserted here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- Agent Review Modal -->
    <div id="agent-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Agent Registration Review</h3>
                <button class="close-btn" onclick="closeModal('agent-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="agent-details">
                    <!-- Agent details populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('agent-modal')">Cancel</button>
                <button class="btn btn-danger" onclick="processAgentDecision('reject')" id="reject-btn">
                    Reject Application
                </button>
                <button class="btn btn-success" onclick="processAgentDecision('approve')" id="approve-btn">
                    Approve Agent
                </button>
            </div>
        </div>
    </div>
    
    <!-- Escrow Management Modal -->
    <div id="escrow-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Blockchain Escrow Management</h3>
                <button class="close-btn" onclick="closeModal('escrow-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="escrow-details">
                    <!-- Escrow details populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('escrow-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="executeEscrowAction()" id="escrow-action-btn">
                    Execute Action
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== IXMRT ADMIN DASHBOARD - ARCH 3 (PRODUCTION JAVASCRIPT) =====
        
        // Global Configuration
        const CONFIG = {
            // Solana Configuration
            SOLANA: {
                NETWORK: 'devnet', // Change to 'mainnet-beta' for production
                RPC_ENDPOINT: 'https://api.devnet.solana.com',
                PROGRAM_ID: '11111111111111111111111111111112', // TODO: Replace with deployed program ID
                ADMIN_WALLET: null, // Set when wallet connects
            },
            
            // API Configuration 
            API: {
                // TODO: Replace with actual backend endpoints
                BASE_URL: 'https://api.ixmrt.com', // GitHub Pages deployment will need CORS proxy
                ENDPOINTS: {
                    AGENTS: '/api/v1/agents',
                    ESCROWS: '/api/v1/escrows',
                    ANALYTICS: '/api/v1/analytics',
                    BLOCKCHAIN: '/api/v1/blockchain'
                },
                TIMEOUT: 30000,
                RETRY_ATTEMPTS: 3
            },
            
            // Cache Configuration
            CACHE: {
                TTL: 5 * 60 * 1000, // 5 minutes
                KEYS: {
                    AGENTS: 'ixmrt_agents',
                    ESCROWS: 'ixmrt_escrows',
                    METRICS: 'ixmrt_metrics'
                }
            }
        };
        
        // Application State Management
        class AdminState {
            constructor() {
                this.wallet = null;
                this.connection = null;
                this.program = null;
                this.agents = [];
                this.escrows = [];
                this.metrics = {};
                this.filters = {
                    agents: { location: '', experience: '', kyc: '' },
                    escrows: { status: '', type: '', amount: '' }
                };
                this.currentAgent = null;
                this.currentEscrow = null;
                this.loading = {
                    agents: false,
                    escrows: false,
                    metrics: false
                };
            }
            
            // State persistence
            saveToCache(key, data) {
                try {
                    const cacheData = {
                        data,
                        timestamp: Date.now(),
                        ttl: CONFIG.CACHE.TTL
                    };
                    localStorage.setItem(key, JSON.stringify(cacheData));
                } catch (error) {
                    console.warn('Failed to save to cache:', error);
                }
            }
            
            loadFromCache(key) {
                try {
                    const cached = localStorage.getItem(key);
                    if (!cached) return null;
                    
                    const { data, timestamp, ttl } = JSON.parse(cached);
                    if (Date.now() - timestamp > ttl) {
                        localStorage.removeItem(key);
                        return null;
                    }
                    
                    return data;
                } catch (error) {
                    console.warn('Failed to load from cache:', error);
                    return null;
                }
            }
        }
        
        // Initialize global state
        const state = new AdminState();
        
        // ===== BLOCKCHAIN INTEGRATION =====
        
        class SolanaService {
            constructor() {
                this.connection = null;
                this.wallet = null;
                this.program = null;
            }
            
            async initialize() {
                try {
                    // Initialize Solana connection
                    this.connection = new solanaWeb3.Connection(
                        CONFIG.SOLANA.RPC_ENDPOINT,
                        'confirmed'
                    );
                    
                    // Test connection
                    const version = await this.connection.getVersion();
                    console.log('Solana connection established:', version);
                    
                    // TODO: Initialize Anchor program when contract is deployed
                    // this.program = new anchor.Program(idl, programId, provider);
                    
                    return true;
                } catch (error) {
                    console.error('Failed to initialize Solana service:', error);
                    throw new Error('Blockchain connection failed');
                }
            }
            
            async connectWallet() {
                try {
                    // Check for Phantom wallet
                    if (!window.solana?.isPhantom) {
                        throw new Error('Phantom wallet not found. Please install Phantom wallet extension.');
                    }
                    
                    // Connect wallet
                    const response = await window.solana.connect();
                    this.wallet = window.solana;
                    CONFIG.SOLANA.ADMIN_WALLET = response.publicKey.toString();
                    
                    // Update UI
                    this.updateWalletUI(true, response.publicKey.toString());
                    
                    showToast('success', 'Admin wallet connected successfully');
                    return response.publicKey;
                    
                } catch (error) {
                    console.error('Wallet connection failed:', error);
                    showToast('error', error.message || 'Failed to connect wallet');
                    throw error;
                }
            }
            
            updateWalletUI(connected, address = '') {
                const statusEl = document.getElementById('wallet-status');
                const connectBtn = document.getElementById('connect-wallet-btn');
                const addressEl = document.getElementById('wallet-address');
                
                if (connected) {
                    statusEl.style.display = 'flex';
                    connectBtn.style.display = 'none';
                    addressEl.textContent = `${address.substring(0, 8)}...${address.substring(-4)}`;
                } else {
                    statusEl.style.display = 'none';
                    connectBtn.style.display = 'block';
                }
            }
            
            async getEscrowAccounts() {
                if (!this.connection) {
                    throw new Error('Solana connection not initialized');
                }
                
                try {
                    // TODO: Query escrow accounts from deployed program
                    // const accounts = await this.program.account.escrowAccount.all();
                    
                    // For now, simulate blockchain query
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    return this.generateMockEscrows();
                    
                } catch (error) {
                    console.error('Failed to fetch escrow accounts:', error);
                    throw new Error('Failed to query blockchain escrows');
                }
            }
            
            async approveEscrow(escrowId) {
                if (!this.wallet) {
                    throw new Error('Admin wallet not connected');
                }
                
                try {
                    // TODO: Create and send approve escrow transaction
                    // const tx = await this.program.methods
                    //   .approveEscrow()
                    //   .accounts({
                    //     escrowAccount: escrowId,
                    //     admin: this.wallet.publicKey
                    //   })
                    //   .rpc();
                    
                    // Simulate transaction
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    showToast('success', `Escrow ${escrowId} approved on blockchain`);
                    return 'simulated_transaction_hash';
                    
                } catch (error) {
                    console.error('Escrow approval failed:', error);
                    throw new Error('Blockchain transaction failed');
                }
            }
            
            async resolveDispute(escrowId, resolution, apprenticeShare = null) {
                if (!this.wallet) {
                    throw new Error('Admin wallet not connected');
                }
                
                try {
                    // TODO: Create and send dispute resolution transaction
                    
                    // Simulate transaction
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    showToast('success', `Dispute resolved for escrow ${escrowId}`);
                    return 'simulated_resolution_hash';
                    
                } catch (error) {
                    console.error('Dispute resolution failed:', error);
                    throw new Error('Blockchain transaction failed');
                }
            }
            
            generateMockEscrows() {
                return [
                    {
                        id: 'escrow_' + Math.random().toString(36).substr(2, 9),
                        apprentice: solanaWeb3.Keypair.generate().publicKey.toString(),
                        agent: solanaWeb3.Keypair.generate().publicKey.toString(),
                        amount: 0.5,
                        apprenticeshipDuration: 6,
                        escrowType: 'PayToLearn',
                        status: 'pending',
                        createdAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
                        transactionId: 'tx_' + Math.random().toString(36).substr(2, 15)
                    },
                    {
                        id: 'escrow_' + Math.random().toString(36).substr(2, 9),
                        apprentice: solanaWeb3.Keypair.generate().publicKey.toString(),
                        agent: solanaWeb3.Keypair.generate().publicKey.toString(),
                        amount: 0.05,
                        apprenticeshipDuration: 12,
                        escrowType: 'CompensationAfterService',
                        status: 'active',
                        createdAt: new Date(Date.now() - Math.random() * 14 * 24 * 60 * 60 * 1000).toISOString(),
                        approvedAt: new Date(Date.now() - Math.random() * 10 * 24 * 60 * 60 * 1000).toISOString(),
                        transactionId: 'tx_' + Math.random().toString(36).substr(2, 15)
                    },
                    {
                        id: 'escrow_' + Math.random().toString(36).substr(2, 9),
                        apprentice: solanaWeb3.Keypair.generate().publicKey.toString(),
                        agent: solanaWeb3.Keypair.generate().publicKey.toString(),
                        amount: 0.3,
                        apprenticeshipDuration: 3,
                        escrowType: 'PayToLearn',
                        status: 'disputed',
                        createdAt: new Date(Date.now() - Math.random() * 21 * 24 * 60 * 60 * 1000).toISOString(),
                        approvedAt: new Date(Date.now() - Math.random() * 18 * 24 * 60 * 60 * 1000).toISOString(),
                        disputedAt: new Date(Date.now() - Math.random() * 3 * 24 * 60 * 60 * 1000).toISOString(),
                        transactionId: 'tx_' + Math.random().toString(36).substr(2, 15)
                    }
                ];
            }
        }
        
        // Initialize Solana service
        const solanaService = new SolanaService();
        
        // ===== API SERVICE =====
        
        class ApiService {
            constructor() {
                this.baseURL = CONFIG.API.BASE_URL;
                this.timeout = CONFIG.API.TIMEOUT;
            }
            
            async makeRequest(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const config = {
                    timeout: this.timeout,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Auth': CONFIG.SOLANA.ADMIN_WALLET || 'development',
                        ...options.headers
                    },
                    ...options
                };
                
                let attempts = 0;
                while (attempts < CONFIG.API.RETRY_ATTEMPTS) {
                    try {
                        // TODO: Replace with actual API calls when backend is ready
                        // For GitHub Pages demo, simulate API responses
                        return await this.simulateApiCall(endpoint, options);
                        
                    } catch (error) {
                        attempts++;
                        if (attempts === CONFIG.API.RETRY_ATTEMPTS) {
                            throw error;
                        }
                        
                        // Exponential backoff
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempts) * 1000));
                    }
                }
            }
            
            async simulateApiCall(endpoint, options) {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));
                
                if (endpoint.includes('/agents')) {
                    return this.generateMockAgents();
                } else if (endpoint.includes('/escrows')) {
                    return solanaService.generateMockEscrows();
                } else if (endpoint.includes('/analytics')) {
                    return this.generateMockAnalytics();
                }
                
                return { success: true, data: [] };
            }
            
            async fetchAgents(filters = {}) {
                const queryString = new URLSearchParams(filters).toString();
                const endpoint = `${CONFIG.API.ENDPOINTS.AGENTS}?${queryString}`;
                return await this.makeRequest(endpoint);
            }
            
            async approveAgent(agentId, notes = '') {
                const endpoint = `${CONFIG.API.ENDPOINTS.AGENTS}/${agentId}/approve`;
                return await this.makeRequest(endpoint, {
                    method: 'POST',
                    body: JSON.stringify({ notes })
                });
            }
            
            async rejectAgent(agentId, reason = '') {
                const endpoint = `${CONFIG.API.ENDPOINTS.AGENTS}/${agentId}/reject`;
                return await this.makeRequest(endpoint, {
                    method: 'POST',
                    body: JSON.stringify({ reason })
                });
            }
            
            generateMockAgents() {
                const locations = ['computer-village', 'unilag', 'unical', 'uniben', 'caleb', 'uniabuja'];
                const experiences = ['1-2', '3-5', '6-10', '10+'];
                const kycStatuses = ['verified', 'pending'];
                const names = ['Emeka Okafor', 'Adaora Chukwu', 'Ibrahim Hassan', 'Funmi Adebayo', 'Kemi Oladipo'];
                const businesses = ['TechFix Pro', 'iPhone Masters', 'Mobile Repair Hub', 'Device Doctors', 'Smart Fix'];
                
                return Array.from({ length: 5 }, (_, i) => ({
                    id: 'agent_' + Math.random().toString(36).substr(2, 9),
                    businessName: businesses[i] + ' ' + locations[Math.floor(Math.random() * locations.length)].toUpperCase(),
                    ownerName: names[i],
                    phone: `+234 ${Math.floor(Math.random() * 900 + 100)} ${Math.floor(Math.random() * 900 + 100)} ${Math.floor(Math.random() * 9000 + 1000)}`,
                    location: locations[Math.floor(Math.random() * locations.length)],
                    experience: experiences[Math.floor(Math.random() * experiences.length)],
                    jobStreak: Math.floor(Math.random() * 500 + 50),
                    devices: ['iphone', 'ipad', 'macbook'].slice(0, Math.floor(Math.random() * 3) + 1),
                    repairs: ['screen', 'battery', 'water-damage', 'motherboard'].slice(0, Math.floor(Math.random() * 4) + 1),
                    tiktokHandle: '@' + businesses[i].toLowerCase().replace(' ', '') + '_ng',
                    diplomaDuration: ['6-months', '1-year', '2-years'][Math.floor(Math.random() * 3)],
                    introVideo: `https://example.com/video${i + 1}.mp4`,
                    kycStatus: kycStatuses[Math.floor(Math.random() * kycStatuses.length)],
                    fixProcess: `Comprehensive ${Math.floor(Math.random() * 5) + 5}-step repair process with quality assurance and customer satisfaction guarantee. Includes diagnostic testing, parts verification, and post-repair warranty.`,
                    submittedAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'pending'
                }));
            }
            
            generateMockAnalytics() {
                return {
                    trainingRecords: 1247 + Math.floor(Math.random() * 100),
                    qualityScore: (4.5 + Math.random() * 0.5).toFixed(1),
                    completionRate: Math.floor(92 + Math.random() * 8),
                    blockchainHealth: Math.random() > 0.1 ? 'Healthy' : 'Degraded'
                };
            }
        }
        
        // Initialize API service
        const apiService = new ApiService();
        
        // ===== UI MANAGEMENT =====
        
        async function initializeDashboard() {
            try {
                showToast('info', 'Initializing admin dashboard...');
                
                // Initialize Solana connection
                await solanaService.initialize();
                
                // Load cached data first for instant UI
                loadCachedData();
                
                // Load fresh data
                await Promise.allSettled([
                    loadAgentData(),
                    loadEscrowData(),
                    loadAnalytics()
                ]);
                
                // Set up auto-refresh
                setupAutoRefresh();
                
                showToast('success', 'Dashboard initialized successfully');
                
            } catch (error) {
                console.error('Dashboard initialization failed:', error);
                showToast('error', 'Failed to initialize dashboard: ' + error.message);
                handleInitializationError(error);
            }
        }
        
        function loadCachedData() {
            const cachedAgents = state.loadFromCache(CONFIG.CACHE.KEYS.AGENTS);
            const cachedEscrows = state.loadFromCache(CONFIG.CACHE.KEYS.ESCROWS);
            const cachedMetrics = state.loadFromCache(CONFIG.CACHE.KEYS.METRICS);
            
            if (cachedAgents) {
                state.agents = cachedAgents;
                displayAgents();
            }
            
            if (cachedEscrows) {
                state.escrows = cachedEscrows;
                displayEscrows();
            }
            
            if (cachedMetrics) {
                state.metrics = cachedMetrics;
                updateMetricsDisplay();
            }
        }
        
        async function loadAgentData() {
            if (state.loading.agents) return;
            
            state.loading.agents = true;
            updateLoadingState('agents', true);
            
            try {
                const agents = await apiService.fetchAgents(state.filters.agents);
                state.agents = agents;
                state.saveToCache(CONFIG.CACHE.KEYS.AGENTS, agents);
                displayAgents();
                
            } catch (error) {
                console.error('Failed to load agent data:', error);
                showToast('error', 'Failed to load agent registrations');
                displayError('pending-agents', 'Failed to load agent data');
                
            } finally {
                state.loading.agents = false;
                updateLoadingState('agents', false);
            }
        }
        
        async function loadEscrowData() {
            if (state.loading.escrows) return;
            
            state.loading.escrows = true;
            updateLoadingState('escrows', true);
            
            try {
                const escrows = await solanaService.getEscrowAccounts();
                state.escrows = escrows;
                state.saveToCache(CONFIG.CACHE.KEYS.ESCROWS, escrows);
                displayEscrows();
                
            } catch (error) {
                console.error('Failed to load escrow data:', error);
                showToast('error', 'Failed to load blockchain escrows');
                displayError('escrow-list', 'Failed to load escrow data');
                
            } finally {
                state.loading.escrows = false;
                updateLoadingState('escrows', false);
            }
        }
        
        async function loadAnalytics() {
            if (state.loading.metrics) return;
            
            state.loading.metrics = true;
            
            try {
                const analytics = await apiService.generateMockAnalytics();
                state.metrics = analytics;
                state.saveToCache(CONFIG.CACHE.KEYS.METRICS, analytics);
                updateMetricsDisplay();
                updateSystemAlerts();
                
            } catch (error) {
                console.error('Failed to load analytics:', error);
                showToast('error', 'Failed to load system analytics');
                
            } finally {
                state.loading.metrics = false;
            }
        }
        
        function updateLoadingState(section, isLoading) {
            const badges = {
                agents: 'agent-badge',
                escrows: 'escrow-badge'
            };
            
            const badge = document.getElementById(badges[section]);
            if (badge) {
                badge.textContent = isLoading ? 'Loading...' : 'Ready';
                badge.className = `status-badge ${isLoading ? 'status-pending' : 'status-active'}`;
            }
        }
        
        function displayAgents() {
            const tbody = document.getElementById('pending-agents');
            const filteredAgents = filterAgents();
            
            if (filteredAgents.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <h3>No pending agents found</h3>
                            <p>All agent registrations have been processed or filters are too restrictive.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredAgents.map(agent => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="agent-avatar">${agent.ownerName.charAt(0)}</div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 2px;">${agent.ownerName}</div>
                                <div style="font-size: 12px; color: #6b7280;">${agent.phone}</div>
                                <div style="font-size: 11px; color: #9ca3af; margin-top: 2px;">ID: ${agent.id}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: 600; margin-bottom: 2px;">${agent.businessName}</div>
                        <div style="display: flex; align-items: center; gap: 6px; margin-top: 4px;">
                            <span class="status-badge ${agent.kycStatus === 'verified' ? 'status-verified' : 'status-pending'}" style="font-size: 10px;">
                                KYC: ${agent.kycStatus}
                            </span>
                        </div>
                        <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">${agent.tiktokHandle}</div>
                    </td>
                    <td>
                        <span class="status-badge" style="background: #e0e7ff; color: #3730a3;">
                            ${getLocationName(agent.location)}
                        </span>
                    </td>
                    <td>
                        <div style="font-weight: 600;">${agent.experience} years</div>
                        <div style="font-size: 11px; color: #6b7280;">${agent.diplomaDuration} training</div>
                    </td>
                    <td>
                        <div style="font-weight: 600; color: #10b981; font-size: 16px;">${agent.jobStreak}</div>
                        <div style="font-size: 11px; color: #6b7280;">successful repairs</div>
                        <div style="font-size: 10px; color: #059669; margin-top: 2px;">
                            ${Math.floor(Math.random() * 100 + 85)}% success rate
                        </div>
                    </td>
                    <td>
                        <div style="font-size: 13px;">${formatDate(agent.submittedAt)}</div>
                    </td>
                    <td>
                        <button class="btn btn-primary" onclick="reviewAgent('${agent.id}')" 
                                ${state.loading.agents ? 'disabled' : ''}>
                            Review
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Update agent badge count
            document.getElementById('agent-badge').textContent = `${filteredAgents.length} Pending`;
        }
        
        function displayEscrows() {
            const tbody = document.getElementById('escrow-list');
            const filteredEscrows = filterEscrows();
            
            if (filteredEscrows.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <h3>No escrow contracts found</h3>
                            <p>No contracts match the current filters or none exist yet.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredEscrows.map(escrow => `
                <tr>
                    <td>
                        <div style="font-family: monospace; font-size: 11px; background: #f1f5f9; padding: 4px 6px; border-radius: 4px; margin-bottom: 4px;">
                            ${escrow.id}
                        </div>
                        <div style="font-size: 10px; color: #6b7280;">
                            TX: ${escrow.transactionId.substring(0, 12)}...
                        </div>
                    </td>
                    <td>
                        <div style="font-size: 11px; margin-bottom: 4px;">
                            <span style="color: #6b7280;">Apprentice:</span><br>
                            <code style="font-size: 10px;">${escrow.apprentice.substring(0, 8)}...${escrow.apprentice.substring(-4)}</code>
                        </div>
                        <div style="font-size: 11px;">
                            <span style="color: #6b7280;">Agent:</span><br>
                            <code style="font-size: 10px;">${escrow.agent.substring(0, 8)}...${escrow.agent.substring(-4)}</code>
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: 700; font-size: 16px; color: #1f2937;">
                            ${escrow.amount} SOL
                        </div>
                        <div style="font-size: 11px; color: #6b7280;">
                            ≈ ${(escrow.amount * 100).toFixed(2)} USD
                        </div>
                    </td>
                    <td>
                        <span class="status-badge" style="background: #f3e8ff; color: #7c3aed; font-size: 10px;">
                            ${escrow.escrowType === 'PayToLearn' ? 'Pay to Learn' : 'Earn After Service'}
                        </span>
                    </td>
                    <td>
                        <div style="font-weight: 600;">${escrow.apprenticeshipDuration} months</div>
                    </td>
                    <td>
                        <span class="status-badge status-${escrow.status}">
                            ${escrow.status.charAt(0).toUpperCase() + escrow.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div style="font-size: 12px;">${formatDate(escrow.createdAt)}</div>
                        ${escrow.approvedAt ? `<div style="font-size: 10px; color: #059669;">Approved: ${formatDate(escrow.approvedAt)}</div>` : ''}
                        ${escrow.disputedAt ? `<div style="font-size: 10px; color: #dc2626;">Disputed: ${formatDate(escrow.disputedAt)}</div>` : ''}
                    </td>
                    <td>
                        <button class="btn btn-primary" onclick="manageEscrow('${escrow.id}')"
                                ${state.loading.escrows ? 'disabled' : ''}>
                            Manage
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Update escrow badge count  
            const pendingCount = filteredEscrows.filter(e => e.status === 'pending').length;
            const disputedCount = filteredEscrows.filter(e => e.status === 'disputed').length;
            
            const badgeText = disputedCount > 0 ? `${disputedCount} Disputed` : 
                             pendingCount > 0 ? `${pendingCount} Pending` : 
                             `${filteredEscrows.length} Total`;
            document.getElementById('escrow-badge').textContent = badgeText;
        }
        
        function updateMetricsDisplay() {
            const metrics = state.metrics;
            
            // Count metrics from loaded data
            const pendingCount = state.escrows.filter(e => e.status === 'pending').length;
            const activeCount = state.escrows.filter(e => e.status === 'active').length;
            const disputedCount = state.escrows.filter(e => e.status === 'disputed').length;
            const agentsCount = state.agents.length;
            
            // Update dashboard metrics
            document.getElementById('pending-count').innerHTML = pendingCount || '<div class="stat-loading"></div>';
            document.getElementById('active-count').innerHTML = activeCount || '<div class="stat-loading"></div>';
            document.getElementById('disputed-count').innerHTML = disputedCount || '<div class="stat-loading"></div>';
            document.getElementById('agents-count').innerHTML = agentsCount || '<div class="stat-loading"></div>';
            
            // Update analytics metrics
            if (metrics.trainingRecords) {
                document.getElementById('training-records').textContent = metrics.trainingRecords.toLocaleString();
            }
            if (metrics.qualityScore) {
                document.getElementById('quality-scores').textContent = `${metrics.qualityScore}/5`;
            }
            if (metrics.completionRate) {
                document.getElementById('completion-rate').textContent = `${metrics.completionRate}%`;
            }
            if (metrics.blockchainHealth) {
                const healthEl = document.getElementById('blockchain-health');
                healthEl.textContent = metrics.blockchainHealth;
                healthEl.style.color = metrics.blockchainHealth === 'Healthy' ? '#10b981' : '#ef4444';
            }
        }
        
        function updateSystemAlerts() {
            const alertsContainer = document.getElementById('system-alerts');
            const alerts = [];
            
            // Check for critical issues
            const disputedCount = state.escrows.filter(e => e.status === 'disputed').length;
            const pendingAgents = state.agents.filter(a => a.status === 'pending').length;
            
            if (disputedCount > 0) {
                alerts.push({
                    type: 'warning',
                    message: `${disputedCount} escrow contract${disputedCount > 1 ? 's' : ''} require dispute resolution.`,
                    action: 'Review disputed contracts immediately to maintain system trust.'
                });
            }
            
            if (pendingAgents > 5) {
                alerts.push({
                    type: 'info',
                    message: `${pendingAgents} agent registrations awaiting approval.`,
                    action: 'Review and process applications to expand network coverage.'
                });
            }
            
            if (state.metrics.blockchainHealth === 'Degraded') {
                alerts.push({
                    type: 'danger',
                    message: 'Blockchain connection experiencing issues.',
                    action: 'Check Solana network status and RPC endpoint connectivity.'
                });
            }
            
            // Positive alerts
            if (state.metrics.completionRate > 95) {
                alerts.push({
                    type: 'success',
                    message: 'Excellent apprenticeship completion rate maintained.',
                    action: 'System operating at optimal performance levels.'
                });
            }
            
            if (alerts.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="alert alert-success">
                        <strong>System Status: All Clear</strong><br>
                        No critical issues detected. All systems operating normally.
                    </div>
                `;
            } else {
                alertsContainer.innerHTML = alerts.map(alert => `
                    <div class="alert alert-${alert.type}">
                        <strong>${alert.type.charAt(0).toUpperCase() + alert.type.slice(1)}:</strong> ${alert.message}<br>
                        <small>${alert.action}</small>
                    </div>
                `).join('');
            }
        }
        
        // ===== FILTERING AND SEARCH =====
        
        function applyAgentFilters() {
            state.filters.agents = {
                location: document.getElementById('location-filter').value,
                experience: document.getElementById('experience-filter').value,
                kyc: document.getElementById('kyc-filter').value
            };
            displayAgents();
        }
        
        function applyEscrowFilters() {
            state.filters.escrows = {
                status: document.getElementById('escrow-filter').value,
                type: document.getElementById('type-filter').value,
                amount: document.getElementById('amount-filter').value
            };
            displayEscrows();
        }
        
        function filterAgents() {
            let filtered = [...state.agents];
            
            if (state.filters.agents.location) {
                filtered = filtered.filter(agent => agent.location === state.filters.agents.location);
            }
            
            if (state.filters.agents.experience) {
                filtered = filtered.filter(agent => agent.experience === state.filters.agents.experience);
            }
            
            if (state.filters.agents.kyc) {
                filtered = filtered.filter(agent => agent.kycStatus === state.filters.agents.kyc);
            }
            
            return filtered;
        }
        
        function filterEscrows() {
            let filtered = [...state.escrows];
            
            if (state.filters.escrows.status) {
                filtered = filtered.filter(escrow => escrow.status === state.filters.escrows.status);
            }
            
            if (state.filters.escrows.type) {
                filtered = filtered.filter(escrow => escrow.escrowType === state.filters.escrows.type);
            }
            
            if (state.filters.escrows.amount) {
                const [min, max] = parseAmountRange(state.filters.escrows.amount);
                filtered = filtered.filter(escrow => escrow.amount >= min && (max === null || escrow.amount <= max));
            }
            
            return filtered;
        }
        
        function parseAmountRange(rangeStr) {
            if (rangeStr === '0-0.1') return [0, 0.1];
            if (rangeStr === '0.1-0.5') return [0.1, 0.5];
            if (rangeStr === '0.5-1') return [0.5, 1];
            if (rangeStr === '1+') return [1, null];
            return [0, null];
        }
        
        // ===== AGENT MANAGEMENT =====
        
        async function reviewAgent(agentId) {
            const agent = state.agents.find(a => a.id === agentId);
            if (!agent) {
                showToast('error', 'Agent not found');
                return;
            }
            
            state.currentAgent = agent;
            
            const detailsHtml = `
                <div class="escrow-details">
                    <div class="detail-item">
                        <span class="detail-label">Business Name:</span>
                        <span class="detail-value">${agent.businessName}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Owner:</span>
                        <span class="detail-value">${agent.ownerName}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">${agent.phone}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Location:</span>
                        <span class="detail-value">${getLocationName(agent.location)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Experience:</span>
                        <span class="detail-value">${agent.experience} years</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Success Streak:</span>
                        <span class="detail-value">${agent.jobStreak} repairs</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">TikTok:</span>
                        <span class="detail-value">${agent.tiktokHandle}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">KYC Status:</span>
                        <span class="detail-value">
                            <span class="status-badge ${agent.kycStatus === 'verified' ? 'status-verified' : 'status-pending'}">
                                ${agent.kycStatus}
                            </span>
                        </span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Device Specializations:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                        ${agent.devices.map(device => `
                            <span class="status-badge" style="background: #e0e7ff; color: #3730a3;">
                                ${device.replace('-', ' ').toUpperCase()}
                            </span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Repair Types:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                        ${agent.repairs.map(repair => `
                            <span class="status-badge" style="background: #d1fae5; color: #065f46;">
                                ${repair.replace('-', ' ').toUpperCase()}
                            </span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Repair Process Documentation:</label>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border-left: 4px solid #5a67d8; margin-top: 8px;">
                        <p style="margin: 0; color: #475569; line-height: 1.6; font-size: 14px;">${agent.fixProcess}</p>
                    </div>
                    <small style="color: #6b7280; margin-top: 8px; display: block;">
                        This documentation is used to train AI systems for automated repair recommendations and quality standards.
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Training Background:</label>
                    <div style="color: #374151; font-weight: 500;">${agent.diplomaDuration} technical program</div>
                </div>
                
                ${agent.introVideo ? `
                    <div class="form-group">
                        <label class="form-label">Introduction Video:</label>
                        <a href="${agent.introVideo}" target="_blank" class="btn btn-secondary">
                            View Video
                        </a>
                    </div>
                ` : ''}
                
                <div class="form-group">
                    <label class="form-label">Admin Decision Notes:</label>
                    <textarea class="form-textarea" id="admin-notes" rows="3" 
                              placeholder="Document your decision reasoning for audit trail..."></textarea>
                </div>
            `;
            
            document.getElementById('agent-details').innerHTML = detailsHtml;
            showModal('agent-modal');
        }
        
        async function processAgentDecision(decision) {
            if (!state.currentAgent) return;
            
            const notes = document.getElementById('admin-notes').value.trim();
            if (!notes) {
                showToast('warning', 'Please provide decision notes for audit trail');
                return;
            }
            
            const approveBtn = document.getElementById('approve-btn');
            const rejectBtn = document.getElementById('reject-btn');
            
            approveBtn.disabled = true;
            rejectBtn.disabled = true;
            
            try {
                if (decision === 'approve') {
                    approveBtn.innerHTML = '<div class="loading-spinner"></div> Approving...';
                    await apiService.approveAgent(state.currentAgent.id, notes);
                    
                    // Remove from pending list
                    state.agents = state.agents.filter(a => a.id !== state.currentAgent.id);
                    
                    showToast('success', `${state.currentAgent.businessName} has been approved and added to verified agent network`);
                    
                } else {
                    rejectBtn.innerHTML = '<div class="loading-spinner"></div> Rejecting...';
                    await apiService.rejectAgent(state.currentAgent.id, notes);
                    
                    // Remove from pending list
                    state.agents = state.agents.filter(a => a.id !== state.currentAgent.id);
                    
                    showToast('warning', `Application for ${state.currentAgent.businessName} has been rejected`);
                }
                
                // Update cache and UI
                state.saveToCache(CONFIG.CACHE.KEYS.AGENTS, state.agents);
                displayAgents();
                updateMetricsDisplay();
                closeModal('agent-modal');
                
            } catch (error) {
                console.error('Agent decision processing failed:', error);
                showToast('error', `Failed to ${decision} agent: ${error.message}`);
                
            } finally {
                approveBtn.disabled = false;
                rejectBtn.disabled = false;
                approveBtn.innerHTML = 'Approve Agent';
                rejectBtn.innerHTML = 'Reject Application';
            }
        }
        
        // ===== ESCROW MANAGEMENT =====
        
        async function manageEscrow(escrowId) {
            const escrow = state.escrows.find(e => e.id === escrowId);
            if (!escrow) {
                showToast('error', 'Escrow contract not found');
                return;
            }
            
            state.currentEscrow = escrow;
            
            const detailsHtml = `
                <div class="escrow-details">
                    <div class="detail-item">
                        <span class="detail-label">Contract ID:</span>
                        <span class="detail-value" style="font-family: monospace; font-size: 12px;">${escrow.id}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Transaction Hash:</span>
                        <span class="detail-value" style="font-family: monospace; font-size: 11px;">${escrow.transactionId}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Amount:</span>
                        <span class="detail-value" style="font-weight: 700; color: #1f2937;">${escrow.amount} SOL</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">USD Value:</span>
                        <span class="detail-value">≈ ${(escrow.amount * 100).toFixed(2)} USD</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Contract Type:</span>
                        <span class="detail-value">${escrow.escrowType === 'PayToLearn' ? 'Pay to Learn' : 'Earn After Service'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">${escrow.apprenticeshipDuration} months</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value">
                            <span class="status-badge status-${escrow.status}">
                                ${escrow.status.charAt(0).toUpperCase() + escrow.status.slice(1)}
                            </span>
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Created:</span>
                        <span class="detail-value">${formatDate(escrow.createdAt)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Apprentice:</span>
                        <span class="detail-value" style="font-family: monospace; font-size: 11px;">${escrow.apprentice}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Agent:</span>
                        <span class="detail-value" style="font-family: monospace; font-size: 11px;">${escrow.agent}</span>
                    </div>
                </div>
                
                ${escrow.approvedAt ? `
                    <div class="alert alert-success">
                        <strong>Approved:</strong> ${formatDate(escrow.approvedAt)}
                    </div>
                ` : ''}
                
                ${escrow.disputedAt ? `
                    <div class="alert alert-warning">
                        <strong>Dispute Filed:</strong> ${formatDate(escrow.disputedAt)}<br>
                        This contract requires immediate admin intervention for resolution.
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Resolution Action:</label>
                        <select class="form-select" id="dispute-resolution">
                            <option value="">Select resolution method...</option>
                            <option value="refund_apprentice">Full Refund to Apprentice</option>
                            <option value="pay_agent">Full Payment to Agent</option>
                            <option value="split_funds">Split Funds Between Parties</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="split-amount-group" style="display: none;">
                        <label class="form-label">Apprentice Share Amount (SOL):</label>
                        <input type="number" class="form-input" id="apprentice-share" 
                               min="0" max="${escrow.amount}" step="0.001" 
                               placeholder="0.000">
                        <small style="color: #6b7280; margin-top: 4px; display: block;">
                            Agent will receive remaining: ${escrow.amount} - [amount] SOL
                        </small>
                    </div>
                ` : ''}
                
                <div class="form-group">
                    <label class="form-label">Admin Action Notes (Required):</label>
                    <textarea class="form-textarea" id="escrow-notes" rows="3" required
                              placeholder="Document the reason for this blockchain action for audit trail..."></textarea>
                </div>
                
                ${escrow.status === 'pending' ? `
                    <div class="alert alert-info">
                        <strong>Pending Approval:</strong> This escrow contract is awaiting admin approval to become active on the blockchain.
                    </div>
                ` : ''}
            `;
            
            document.getElementById('escrow-details').innerHTML = detailsHtml;
            
            // Configure action button based on escrow status
            const actionBtn = document.getElementById('escrow-action-btn');
            if (escrow.status === 'pending') {
                actionBtn.textContent = 'Approve Escrow Contract';
                actionBtn.className = 'btn btn-success';
            } else if (escrow.status === 'disputed') {
                actionBtn.textContent = 'Execute Dispute Resolution';
                actionBtn.className = 'btn btn-danger';
                
                // Set up split amount input visibility
                const resolutionSelect = document.getElementById('dispute-resolution');
                const splitGroup = document.getElementById('split-amount-group');
                
                resolutionSelect.addEventListener('change', function() {
                    splitGroup.style.display = this.value === 'split_funds' ? 'block' : 'none';
                });
            } else {
                actionBtn.textContent = 'View Contract Details';
                actionBtn.className = 'btn btn-secondary';
            }
            
            showModal('escrow-modal');
        }
        
        async function executeEscrowAction() {
            if (!state.currentEscrow) return;
            
            const escrow = state.currentEscrow;
            const notes = document.getElementById('escrow-notes').value.trim();
            
            if (!notes) {
                showToast('warning', 'Admin action notes are required for audit trail');
                return;
            }
            
            const actionBtn = document.getElementById('escrow-action-btn');
            const originalText = actionBtn.textContent;
            
            actionBtn.disabled = true;
            actionBtn.innerHTML = '<div class="loading-spinner"></div> Processing...';
            
            try {
                if (escrow.status === 'pending') {
                    // Approve escrow on blockchain
                    await solanaService.approveEscrow(escrow.id);
                    
                    // Update local state
                    escrow.status = 'active';
                    escrow.approvedAt = new Date().toISOString();
                    
                    showToast('success', 'Escrow contract approved and activated on blockchain');
                    
                } else if (escrow.status === 'disputed') {
                    // Handle dispute resolution
                    const resolution = document.getElementById('dispute-resolution').value;
                    
                    if (!resolution) {
                        showToast('warning', 'Please select a resolution method');
                        return;
                    }
                    
                    let apprenticeShare = null;
                    if (resolution === 'split_funds') {
                        apprenticeShare = parseFloat(document.getElementById('apprentice-share').value);
                        
                        if (isNaN(apprenticeShare) || apprenticeShare < 0 || apprenticeShare > escrow.amount) {
                            showToast('warning', 'Please enter a valid apprentice share amount');
                            return;
                        }
                    }
                    
                    await solanaService.resolveDispute(escrow.id, resolution, apprenticeShare);
                    
                    // Update local state
                    escrow.status = 'resolved';
                    escrow.resolvedAt = new Date().toISOString();
                    
                    const resolutionMsg = resolution === 'refund_apprentice' ? 'Full refund issued to apprentice' :
                                         resolution === 'pay_agent' ? 'Full payment sent to agent' :
                                         `Funds split: ${apprenticeShare} SOL to apprentice, ${(escrow.amount - apprenticeShare).toFixed(3)} SOL to agent`;
                    
                    showToast('success', `Dispute resolved: ${resolutionMsg}`);
                }
                
                // Update cache and UI
                state.saveToCache(CONFIG.CACHE.KEYS.ESCROWS, state.escrows);
                displayEscrows();
                updateMetricsDisplay();
                updateSystemAlerts();
                closeModal('escrow-modal');
                
            } catch (error) {
                console.error('Escrow action failed:', error);
                showToast('error', `Failed to execute blockchain action: ${error.message}`);
                
            } finally {
                actionBtn.disabled = false;
                actionBtn.innerHTML = originalText;
            }
        }
        
        // ===== WALLET CONNECTION =====
        
        async function connectAdminWallet() {
            const connectBtn = document.getElementById('connect-wallet-btn');
            const originalText = connectBtn.textContent;
            
            connectBtn.disabled = true;
            connectBtn.innerHTML = '<div class="loading-spinner"></div> Connecting...';
            
            try {
                await solanaService.connectWallet();
                
                // Enable blockchain features
                connectBtn.style.display = 'none';
                
            } catch (error) {
                console.error('Wallet connection failed:', error);
                
            } finally {
                connectBtn.disabled = false;
                connectBtn.innerHTML = originalText;
            }
        }
        
        // ===== UTILITY FUNCTIONS =====
        
        function getLocationName(locationCode) {
            const locations = {
                'computer-village': 'Computer Village, Ikeja',
                'unilag': 'UNILAG Campus Area',
                'unical': 'UNICAL Campus Area', 
                'uniben': 'UNIBEN Campus Area',
                'caleb': 'Caleb University Area',
                'uniabuja': 'University of Abuja Area'
            };
            return locations[locationCode] || locationCode;
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            document.body.style.overflow = 'auto';
        }
        
        function showToast(type, message, duration = 5000) {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <div style="font-weight: 600; color: #1f2937;">
                        ${type.charAt(0).toUpperCase() + type.slice(1)}
                    </div>
                    <div style="flex: 1; color: #374151; line-height: 1.4;">
                        ${message}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 16px; padding: 0;">
                        ×
                    </button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
        
        function displayError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <tr>
                    <td colspan="8" class="error-state">
                        <div style="color: #ef4444; font-weight: 600; margin-bottom: 8px;">Error Loading Data</div>
                        <div>${message}</div>
                        <button class="btn btn-secondary" onclick="window.location.reload()" style="margin-top: 15px;">
                            Retry
                        </button>
                    </td>
                </tr>
            `;
        }
        
        function handleInitializationError(error) {
            const dashboardContainer = document.querySelector('.dashboard-container');
            dashboardContainer.innerHTML = `
                <div class="error-state" style="padding: 60px; text-align: center;">
                    <h2 style="color: #ef4444; margin-bottom: 16px;">Dashboard Initialization Failed</h2>
                    <p style="color: #6b7280; margin-bottom: 24px;">${error.message}</p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn btn-primary" onclick="window.location.reload()">
                            Retry
                        </button>
                        <button class="btn btn-secondary" onclick="connectAdminWallet()">
                            Connect Wallet
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ===== AUTO-REFRESH =====
        
        function setupAutoRefresh() {
            // Refresh data every 5 minutes
            setInterval(async () => {
                if (!document.hidden) {
                    try {
                        await Promise.allSettled([
                            loadEscrowData(),
                            loadAnalytics()
                        ]);
                    } catch (error) {
                        console.warn('Auto-refresh failed:', error);
                    }
                }
            }, 5 * 60 * 1000);
            
            // Refresh blockchain data more frequently
            setInterval(async () => {
                if (!document.hidden && solanaService.connection) {
                    try {
                        await loadEscrowData();
                    } catch (error) {
                        console.warn('Blockchain refresh failed:', error);
                    }
                }
            }, 30 * 1000);
        }
        
        // Manual refresh functions
        async function refreshAgentData() {
            await loadAgentData();
            showToast('success', 'Agent data refreshed');
        }
        
        async function refreshEscrowData() {
            await loadEscrowData();
            showToast('success', 'Blockchain data refreshed');
        }
        
        async function refreshAnalytics() {
            await loadAnalytics();
            showToast('success', 'Analytics refreshed');
        }
        
        // ===== INITIALIZATION =====
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
        });
        
        // Handle wallet disconnection
        if (typeof window !== 'undefined' && window.solana) {
            window.solana.on('disconnect', () => {
                solanaService.updateWalletUI(false);
                showToast('warning', 'Admin wallet disconnected');
            });
            
            window.solana.on('accountChanged', (publicKey) => {
                if (publicKey) {
                    CONFIG.SOLANA.ADMIN_WALLET = publicKey.toString();
                    solanaService.updateWalletUI(true, publicKey.toString());
                    showToast('info', 'Admin wallet changed');
                }
            });
        }
        
        // Export admin functions for external integration
        window.IXMRTAdmin = {
            // State
            state,
            
            // Services
            solanaService,
            apiService,
            
            // Core functions
            connectAdminWallet,
            reviewAgent,
            processAgentDecision,
            manageEscrow,
            executeEscrowAction,
            
            // Data management
            loadAgentData,
            loadEscrowData,
            loadAnalytics,
            refreshAgentData,
            refreshEscrowData,
            refreshAnalytics,
            
            // Utility functions
            showToast,
            formatDate,
            showModal,
            closeModal,
            
            // Configuration
            CONFIG
        };
    </script>
</body>
</html>